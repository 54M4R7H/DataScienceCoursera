{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Exploring the BRFSS data\"\noutput: \n  html_document: \n    fig_height: 4\n    highlight: pygments\n    theme: spacelab\n    css: style.css\n---\n\nAuthor: Bruno Hunkeler   \nDate:   24.05.2016\n<hr>\n\n<h2> Behavioral Risk Factor Surveillance System </h2>\n\nThe Behavioral Risk Factor Surveillance System (BRFSS) is a collaborative project between all of the states in\nthe United States (US) and participating US territories and the Centers for Disease Control and Prevention (CDC).\nThe BRFSS is administered and supported by CDC's Population Health Surveillance Branch, under the Division\nof Population Health at the National Center for Chronic Disease Prevention and Health Promotion. <b>BRFSS is an\nongoing surveillance system designed to measure behavioral risk factors for the non-institutionalized adult\npopulation (18 years of age and older) residing in the US.</b> \n\nThe BRFSS objective is to collect uniform, state-specific data on preventive health practices and risk\nbehaviors that are linked to chronic diseases, injuries, and preventable infectious diseases that affect the\nadult population. Factors assessed by the BRFSS in 2013 include tobacco use, HIV/AIDS knowledge and\nprevention, exercise, immunization, health status, healthy days â€” health-related quality of life, health care\naccess, inadequate sleep, hypertension awareness, cholesterol awareness, chronic health conditions, alcohol\nconsumption, fruits and vegetables consumption, arthritis burden, and seatbelt use. \n\n<h3>Data collection</h3>\n\nSince 2011, BRFSS conducts both landline telephone- and cellular telephone-based surveys. In conducting the BRFSS landline\ntelephone survey, interviewers collect data from a randomly selected adult in a household. In conducting the\ncellular telephone version of the BRFSS questionnaire, interviewers collect data from an adult who participates\nby using a cellular telephone and resides in a private residence or college housing.\n\nBRFSS field operations are managed by state health departments that follow protocols adopted by the states\nwith technical assistance provided by CDC. State health departments collaborate during survey development,\nand conduct the interviews themselves or by using contractors. The data are transmitted to the CDC for editing,\nprocessing, weighting, and analysis. An edited and weighted data file is provided to each participating health\ndepartment for each year of data collection, and summary reports of state-specific data are prepared by the\nCDC.\n\nThe data and further information were obtained from the following sources:\n\nDataset: [Behavioral Risk Factor Surveillance System Data](https://d3c33hcgiwev3.cloudfront.net/_384b2d9eda4b29131fb681b243a7767d_brfss2013.RData?Expires=1464220800&Signature=QjjfkYt-C-wTRcwEvnuyFDvphasfoKEAkMo-088OscAJxIV7NbLUqOmkJZBXsVLUuJmJZmatWsi7bOoG9WMkp18BK4bGVvEpAjHyar9fOMmT9TcnFax5m2Dj8nJZzqox4IV20XOtnijNbzwQH4N8yd7CtbIc1tNTgeo8mq5ezjQ_&Key-Pair-Id=APKAJLTNE6QMUY6HBC5A) [53MB]\n\nGeneral Information: [2013 Survey Data Information](http://www.cdc.gov/brfss/annual_data/annual_2013.html) \n\n<ul>\n<li>[2013 BRFSS Overview](http://www.cdc.gov/brfss/annual_data/2013/pdf/overview_2013.pdf) [PDF - 84 KB]<br> \n       Provides information on the background, design, data collection and processing, statistical, and <br>\n       analytical issues for the combined landline and cell phone data set.<br><br>\n<li>[2013 BRFSS Codebook](http://www.cdc.gov/brfss/annual_data/2013/pdf/codebook13_llcp.pdf) [PDF - 2.7 MB]<br>\n       Codebook for the file showing variable name, location, and frequency of values for all reporting <br>\n       areas combined for the combined landline and cell phone data set.<br><br>\n<li>[Calculated Variables in Data Files](http://www.cdc.gov/brfss/annual_data/2013/pdf/2013_calculated_variables_version15.pdf) [PDF - 421 KB] <br>\n<li>[Comparability of Data](http://www.cdc.gov/brfss/annual_data/2013/pdf/compare_2013.pdf) [PDF - 96 KB]</b> <br>\n       Comparability of data across reporting areas for the combined landline and cell phone data set.  <br>\n       The BRFSS 2012 data is not directly comparable to years of BRFSS data before 2011 because of the <br>\n       changes in weighting methodology and the addition of the cell phone sampling frame.<br><br>\n<li>[2013 Weighting Formula](http://www.cdc.gov/brfss/annual_data/2013/pdf/weighting_data.pdf) [PDF - 98 KB]<br>\n<li>[Summary Matrix of Calculated Variables (CV) in the 2013 Data File](http://www.cdc.gov/brfss/annual_data/2013/summary_matrix_2013_version5.html)\n</ul>\n\n<h3>Generalizability / Causality</h3>\n\n<h4>Target Population</h4>\nOver time, the number of states participating in the survey increased; by 2001, 50 states were participating. Today all \nStates in the US are part of the survey. BRFSS conducts both landline telephone- and cellular telephone-based surveys. \nIn conducting the BRFSS landline telephone survey, interviewers collect data from a randomly selected adult in a household \nfor the non-institutionalized adult population (18 years of age and older) residing in the US. \n\nOverall, an estimated 97.5% of US households had telephone service in 2012. Telephone coverage varies across states with \na range of 95.3% in New Mexico to 98.6% in Connecticut. The data collection is based on a <b>stratified sampling</b> strategy. <br>\nThe population is divided into groups (States) called strata. Then a <b>random sampling</B> (telephone), has been employed within <br>\neach stratum.\n\n<h4>Genaralizability</h4>\nHaving an estimated 97.3% coverage of US households and a <b>stratified sampling strategy</b> with a <b>random sampling</b> via <br>\ntelefon numbers applied, leads to the fact that the survey is indeed genaralizable to all of the US population. There is still a <br>\nsmall probability that two individuals living in the same household could participate in the survey, if they are using individual <br>\ncell phones. I such cases we can assume that certain behavioral pattern might be equal (nutrition, excercise etc.). But still the chance<br>\nis rather small.\n\n<h4>Causality</h4>\nThe study, by gathering survey data, has the character of an observational study. Taking causal conclusions is almost never recommended <br>\nbased on observational data. In observational studies as this one it is generally only sufficient to show associations.Even if random sampling, <br>\nas mentionaed above, has been applied the questionnaire leaves a lot of open questions. There are environmetal, stress, social etc. aspects \nto be considered if we want to consider the health of a person.  \n\n<h2><b>Setup</b></h2>\n\n<h3><b>Load packages</b></h3>\n\n```{r load-packages, message = FALSE}\nlibrary('ggplot2')    # library to create plots\nlibrary('plyr')       # data manipulation\nlibrary('dplyr')      # data manipulation\nlibrary('gridExtra')  # supports the layout functionality with ggplot\nlibrary('ggmap')      # visualize maps \nlibrary('knitr')      # required to apply knitr options \nlibrary('gtable')     # used to overlay plots in ggplot\nlibrary('grid')       # used to overlay plots in ggplot\n\n# apply general knitr options\nknitr::opts_chunk$set(comment=NA, fig.align='center')\n\n```\n\n<h3><b>Load data</b></h3>\n\nInitial load of the dataset. There is also a definition of the population living in the US in 2013. \n<br>\n```{r load-data}\n# ============================================================================================================\n# Download and extract Data and load file\n# ============================================================================================================\n\n# load the data set \nload(file = 'Data/brfss2013.RData')\n\n```\n\n<hr>\n\n<h3><b>Part 1: Data</b></h3>\n\nThe initial part of the project is get to know your data. I mainly worked with two documents - \n[Calculated Variables in Data Files](http://www.cdc.gov/brfss/annual_data/2013/pdf/2013_calculated_variables_version15.pdf) and \n[2013 BRFSS Codebook](http://www.cdc.gov/brfss/annual_data/2013/pdf/codebook13_llcp.pdf). The analysis of the data requires \nvarious steps to figure out what information is useful or can be discarded. I'll focus on one example to transport the idea of how I \nanalyzed the data. The plots won't be nice and tidy since those are only used for a quick and dirty analysis.\n<br>\n```{r}\n\n# evaluate the size of the dataset\ndim(brfss2013)\n\n```\n\nThe output for the summary- and str() - function has been hidden since the output would be quiet exhaustive (verbose) by having 330 variables.\n<br>\n```{r, results=\"hide\"}\n\n# verify types and summary of each variable \nstr(brfss2013)\nsummary(brfss2013)\n\n```\n\nI reduced the dataset for convenience reasons. I went through the dataset to separate the wheat from the chaff. I verified the number of 'NA' in each \nvariable. Check if it is required to apply an algorithm to fill in the missing data or if I just can delete the incomplete rows. I also verified IRQ's etc. \nVisualization has been used to verify the distribution and to find potential outliners. I used histogramms, boxplots and Q-Q Plot's to visually analyse the data.\nThe steps taken, gave me a quite clear picture of the dataset at hand. \n<br>\n```{r fig.width = 8, fig.height = 8}\n\n# Create a subset of the analysed data, which might be interesting for the rresearch questions\nCol <- c('X_state', 'X_bmi5', 'X_bmi5cat', 'genhlth', 'hlthpln1', 'exerany2', 'X_frtlt1', 'X_veglt1', 'X_pacat1', 'exract11', 'X_age80', 'weight2', 'height3', 'income2', 'educa')\ndata.analysis <- brfss2013[, Col]\n\nstr(data.analysis)\n\n# slightly right skewed\nsummary(data.analysis$X_bmi5)\n\n# create a 2 by 2 plot \npar(mfrow = c(2, 2))\n\n# show the histogram and boxplot to verify the distribution \nhist(data.analysis$X_bmi5, breaks = 100, col = 'steelblue')\nboxplot(data.analysis$X_bmi5, main = \"Boxplot\")\n\n# normal fit \nqqnorm(data.analysis$X_bmi5, col = 'blue');\nqqline(data.analysis$X_bmi5, col = 'red')\n\n# t(3Df) fit \nqqplot(rt(1000, df = 3), data.analysis$X_bmi5, main = \"t(3) Q-Q Plot\",\n   ylab = \"Sample Quantiles\", col = 'blue')\nabline(0, 1, col = 'red')\n\n# calculate mean value\nmean(data.analysis$X_bmi5, na.rm = TRUE)\n\n# calculate median values\nmedian(data.analysis$X_bmi5, na.rm = TRUE)\n\n```\n\nAfter analysing the data I created subsets of the initial dataset. Each research questing has it's own subset. One exception to every rule. \nResearch question 3 has been separated into 3 different datasets right from the start.\n<br>\n```{r, message = FALSE}\n# ============================================================================================================\n# Create Data subsets for each research question by providing only the required columns\n# ============================================================================================================\n\n# Data set for research question 1\nCol <- c('X_state', 'X_bmi5', 'X_bmi5cat')\ndata.rsq1 <- brfss2013[, Col]\n\n# Data set for research question 2\nCol <- c('X_state', 'genhlth', 'hlthpln1', 'X_bmi5cat', 'exerany2')\ndata.rsq2 <- brfss2013[, Col]\n\n# Data set for research question 3\nCol <- c('X_bmi5', 'X_age80')\ndata.rsq3 <- brfss2013[, Col]\n\n# Data set for research question 4\nCol <- c('X_bmi5', 'X_frtlt1', 'X_frutsum', 'X_veglt1', 'X_vegesum', 'X_age80')\ndata.rsq3_a <- brfss2013[, Col]\n\n# Data set for research question 5\nCol <- c('pa1min_', 'X_age80')\ndata.rsq3_b <- brfss2013[, Col]\n\n```\n\n<hr>\n\n<h3><b>Part 2: Research questions</b></h3>\nI'll focus on a widespread social problem - overweight or obesity. \n\n<h4><b>Research question 1:</b></h4>\nDoes the access of health care influence the 'general health' of the population and can we infer a relation (association) <br>\nbetween 'general health' the physical exercise a person performs? \n<br><br>\nObamaCare, officially called the Patient Protection and Affordable Care Act (PPACA), reforms the health insurance industry<br> \nand the American health care system as a whole. <br>\nThe law contains over a thousand pages of provisions that give Americans more rights and protections and expand access to <br>\naffordable quality health care to tens of millions of uninsured. The health care plan is still relatively new, therefore<br>\nit is interesting to see if, having a health care plan already has an impact on the general health of the population.\nHealth care does usually not only include access to doctors and financial aid. It also informs the population, what might be <br>\nrequired in respect to better 'general health'. This includes information about balanced nutrition or physical activities (excercise) etc. \n<br>\n\n<h4><b>Research question 2:</b></h4>\n\nTo continue the initial question about the US population belonging to which BMI category. I'm interested to find out, \nwhich state has the highest obesity rate in the US and what is the distribution troughout the United states in 2013?<br>\n<br>\nThe distribution of the obese population might give an idea if there is a relation (pattern) between rural or municipal areas, <br>\nwhich than leads to more detailled questions as if there might be relations between obesity and physical activity, nutrition, <br>\nincome, health care access or education. \n<br>\n\n<h4><b>Research question 3:</b></h4>\nIs there a relation between BMI and an 'age group' and can we infere a relation (association) between the BMI of age groups and their<br>\nnutrition behavior as well as pysical activity pattern?  \n<br>\nIs it given that a person over the years gains weight, or does an aging person change its behavior in nutrition and pysical activity,<br> \nand therefore is able to lead ab healthier life?  \n\n<hr>\n\n<h3><b>Part 3: Exploratory data analysis</b></h3>\n\n<h4><b>Research question 1:</b></h4>\n\nThe first part of this questions solves the question - what percentage of the us population is associated with which <br>\nbmi category. This is only used to get an general overview, on how we have to classify the situation. ObamaCare, officially <br>\ncalled the Patient Protection and Affordable Care Act (PPACA), reforms the health insurance industry and the <br> \nAmerican health care system as a whole. The law gives Americans more rights and protections and expands access to <br>\naffordable quality health care to tens of millions of uninsured. The health care plan is still relatively new, therefore <br>\nit is interesting to see if, having a health care plan already has an impact on the general health of the population.<br>\n<br>\nI first preprocessed the data towards being able to evaluate the percentage of the US population based on BMI category. <br>\nThe calculated figures are displayed in the following plot as well as in a table below. The preprocessing step first cleans the \ndata from NA values and then data manipulation to calculate the percentage for each category.\n<br>\n```{r, fig.width=8, fig.height=6}\n\n    # ====================================================================================================\n    # Data preprocessing\n    # ====================================================================================================\n\n    USPopulation2013 <- 315091138\n\n    # remove rows with missing data\n    data.rsq2 <- data.rsq2[complete.cases(data.rsq2),]\n\n    # evaluate the percentage of the US population based on bmi Category\n    bmi.cat <- plyr::count(data.rsq2, 'X_bmi5cat')\n    bmi.cat <- bmi.cat[-5,]\n    bmi.cat$percent <- prop.table(bmi.cat$freq)\n    bmi.cat$population <- lapply(bmi.cat$percent, function(x) {\n        USPopulation2013 * x\n    })\n\n    # ====================================================================================================\n    # Create Plots\n    # ====================================================================================================\n\n    ggplot(bmi.cat, aes(x = factor(X_bmi5cat), y = percent, fill = percent, alpha = 0.8)) +\n    geom_bar(stat = 'identity') +\n    xlab('BMI Category') + ylab('Percentage of US population') +\n    ggtitle('Distribution of US population in regards to \\nBMI category') +\n    geom_text(aes(label = round(percent * 100, 2)), vjust = 1.6, color = 'black', position = position_dodge(0.9), size = 3)\n    \n```\n\nThe table indicates that about 2/3 of the US population are overweight or obese. This means that around 200 million people<br> \nfall in one or the other category. Such numbers are alarming since this can cause enormous health- as well as economic cost <br>\nin the future.\n<br>\n\nBMI category   | Percentage of US population  | Number of people in category |\n---------------|------------------------------|------------------------------|\nUnderweight    |  1.74%                       | 5'497'557                    |\nNormal weight  | 33.15%                       | 104'445'574                  |\nOverweight     | 35.92%                       | 113'176'902                  |\nObese          | 29.19%                       | 91'971'105                   | \n\n<br>\nThe mosaic plots below show on one hand the relation between the general health and the health care access. On the <br>\nother hand the relation between general health and the physical exercise.<br>\n<br>\nThe 'health care plan' is still relatively new for lots of the US population , therefore it is interesting to see if, having a <br>\nhealth care plan already has an impact on the general health of the population. The graphic indicates that there is no explicite <br>\ntrend (change) to be found, but if we assume that having a health care plan also sensitizes people with regard to physical exercise<br> \nor nutrition, we see a clear trend that people, performing physical exercise more often tend to lead a healthier life.<br>\nEven if it seems that we might have a causal relation, I wouldn't go that far, since a lot of other factors might be influencing <br>\nthe general health of a person as environmental factors, stress related factors etc.\n<br>\n\n```{r, fig.width = 10, fig.height = 7}\n\n    # ====================================================================================================\n    # Create Plots\n    # ====================================================================================================\n\n    par(mfrow = c(1, 2))\n\n    # is there a relation between healt care and general condition \n    mosaicplot( ~ genhlth + hlthpln1, data = data.rsq2, xlab = 'General health', ylab = 'Health care plan', color = c('lightblue', 'steelblue'), \n                main = 'General health vs helth care plan')\n\n    # is there a relation between exercise and general condition \n    mosaicplot( ~ genhlth + exerany2, data = data.rsq2, xlab = 'General health', ylab = 'Physical excercise', color = c('lightblue', 'steelblue'), \n                main = 'General health vs physical excercise')\n\n    # clean up unused variables \n    rm(bmi.cat)\n    rm(data.rsq2)\n    rm(USPopulation2013)\n    \n```\n\n\n<h4><b>Research question 2:</b></h4>\n\nThere is a data preprocessing step to clean and prepare the dataset. The original dataset contains 491775 rows. Cleaning the data from<br> \nNA'values leaves us with 465048 rows. The data reduction is about 5.5%. This is still sufficient to answer our research question. <br> \nWe need to create a new data frame, which contains the number of person per state participating in the survey. Then we need to apply<br> \na filter to isolate only obese people per state. From there on we calcuate the percentages of obese people per state.<br>\nThere might be a slight inaccuracy in the calculation. People tend to gloss over when it comes to heights and weights (BMI). <br>\nThe missing data might be from people who wanted to hide the fact of overweight.<br> \n<br>\nMy hypothesis was that the obesity rate is higher in rural then in municipal areas. But the analysis indicates a different picture. <br>\nThe center and the west of the US show a lower obesithy rate. The highest obesity rate can be found in the south eastern parts of the US.\n<br>\n```{r}\n\n    # ====================================================================================================\n    # Data preprocessing \n    # ====================================================================================================\n\n    # remove rows with missing data\n    data.rsq1 <- data.rsq1[complete.cases(data.rsq1),]\n\n    # calculate sample size per state\n    survey.population.State <- plyr::count(data.rsq1, 'X_state')\n    colnames(survey.population.State) <- c('X_state', 'Sample')\n\n    # filter for people being Obese\n    # filter.Obese <- data.rsq1 %>% filter(X_bmi5cat == 'Obese')\n    filter.Obese <- subset(data.rsq1, data.rsq1$X_bmi5cat == 'Obese')\n\n    # calculate sample size of Obese people per state\n    obese.population.State <- plyr::count(filter.Obese, 'X_state')\n    colnames(obese.population.State) <- c('X_state', 'Obese')\n\n    # merge data sets and calc percentage\n    survey.population.State <- merge(survey.population.State, obese.population.State)\n    survey.population.State$Percent <- with(survey.population.State, round(Obese * 100 / Sample, 2))\n\n\n```\n\n<br>\nThe prepared data is displayed in a 'heat map' of the United State, indicating which state has the highest <br> \nobesity rate. This requires to merge the map data with the preprocessed survey data. There is also a plot showing <br>\nthe ranking of the top 20 states.\n<br>\n```{r, fig.width=10, fig.height=7}\n\n    # ====================================================================================================\n    # Data preprocessing \n    # ====================================================================================================\n\n    # load map data\n    statesMap <- map_data(\"state\")\n    # str(statesMap)\n\n    # merge the obesity with map data\n    colnames(survey.population.State) <- c('region', 'sample', 'obese', 'percent')\n    survey.population.State$region <- tolower(survey.population.State$region)\n    surveyMap <- merge(statesMap, survey.population.State, by = \"region\")\n\n    str(surveyMap)\n\n    # ====================================================================================================\n    # Create Plots\n    # ====================================================================================================\n\n    # plot the US map and assign the heatmap\n    ggplot() +\n    geom_polygon(data = surveyMap, aes(x = long, y = lat, group = group, fill = percent), colour = \"white\") +\n    scale_fill_continuous(low = \"thistle2\", high = \"darkred\", guide = \"colorbar\") +\n    theme_bw() + labs(fill = \"[%]\", title = \"Distribution of obesity rate in the US in 2013\", x = \"\", y = \"\") +\n    scale_y_continuous(breaks = c()) + scale_x_continuous(breaks = c()) + theme(panel.border = element_blank())\n\n    # order dataset descending and filter top 20 rows\n    survey.population.State.ordered <- survey.population.State[order( - survey.population.State$percent),]\n    survey.population.State.ordered$sample <- NULL\n    survey.population.State.ordered$obese <- NULL\n    survey.population.State.ordered <- filter(survey.population.State.ordered, percent > 1) %>% top_n(20)\n\n    ggplot(data = survey.population.State.ordered, aes(x = reorder(survey.population.State.ordered$region, \n           - survey.population.State.ordered$percent), y = survey.population.State.ordered$percent,\n         fill = percent, alpha = 0.8)) +\n         geom_bar(stat = \"identity\") +\n         xlab(\"State\") + ylab(\"% of population Obese\") +\n         ggtitle(\"Top 20 States with highest obesity rates in 2013\") +\n         theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n         geom_text(aes(label = percent), vjust = 1.6, color = \"black\", position = position_dodge(0.9), size = 3)\n    \n```\n\n<h4><b>Research question 3:</b></h4>\nIn this part I'll answer the question, if there is a relation between BMI and an 'age group' and can we infere <br>\na relation (association) between the BMI of age groups and their nutrition behavior as well as pysical activity pattern.<br>  \nTo answer this question we again have to perform some data preprocessing steps as removing NA values, calculating <br>\nthe average value of the BMI for each age goup and put them in relation.  \n<br>\nThe fact that the BMI has a steep upwards curve from age 18 up to 40 and than levels out until the age 60, is no real surprise.<br>\nBut the fact that after 60 the average BMI drops again, 'nota bene' not only slightly, rather in a steep curve is quite suprising<br>\nto me. My hypothesis was that with higher age the BMI levels out on a high rate and stays there for the last quarter of the life time.  \n<br>\n```{r, fig.width = 8, fig.height = 6}\n\n    # ====================================================================================================\n    # Data preprocessing\n    # ====================================================================================================\n\n    # print unique vales \n    unique(data.rsq3$X_age80)\n\n    # remove NA values\n    data.rsq3 <- data.rsq3[complete.cases(data.rsq3),]\n\n    # convert BMI to percentage and round value\n    data.rsq3$X_bmi5 <- lapply(data.rsq3$X_bmi5, function(x) {\n        round(x / 100, 2)\n    })\n\n    # flatten list to vector\n    data.rsq3$X_bmi5 <- unlist(data.rsq3$X_bmi5, use.names = TRUE)\n\n    mean.bmi <- ddply(data.rsq3, .(X_age80), summarise, mean = mean(X_bmi5))\n\n    # remove age 1 and 2 \n    mean.bmi <- mean.bmi[-1:-2,]\n\n    # ====================================================================================================\n    # Create Plots\n    # ====================================================================================================\n\n    ggplot(mean.bmi, aes(x = mean.bmi$X_age80, y = mean)) +\n    geom_point(col = 'blue') +\n    geom_smooth() +\n    ylab('mean BMI') + xlab(\"Age\") +\n    ggtitle(\"Average BMI vs persons age\")\n    \n```\n\nThe following plot show the average BMI per age as well as the average Nutition per age. Can we infere a causal relation between <br>\nthe two curves? As mentioned earlier, a causal relation might be implied, but there are lots of other factors who can <br>\ninfluence such a situation. But we can imply an association of the different factors.\n<br>\n```{r, fig.width=8, fig.height=6}\n\n    # ====================================================================================================\n    # Data preprocessing\n    # ====================================================================================================\n\n    # remove NA values\n    data.rsq3_a <- data.rsq3_a[complete.cases(data.rsq3_a),]\n\n    data.rsq3_a <- data.rsq3_a %>% mutate(X_frtlt1 = ifelse(X_frtlt1 %in% \n                                                    c(\"Consumed fruit one or more times per day\"), 1, 0))\n    data.rsq3_a <- data.rsq3_a %>% mutate(X_veglt1 = ifelse(X_veglt1 %in% \n                                                    c(\"Consumed vegetables one or more times per day\"), 1, 0))\n\n    data.rsq3_a$nutrition <- with(data.rsq3_a, round(((X_frutsum + X_vegesum) / 100), 2))\n\n    mean.nutrition <- ddply(data.rsq3_a, .(X_age80), summarise, meanNu = mean(nutrition))\n\n    # remove age 1  \n    mean.nutrition <- mean.nutrition[-1,]\n\n    # ====================================================================================================\n    # Create Plots\n    # ====================================================================================================\n\n    mean.p1 <- ggplot(mean.bmi, aes(x = X_age80, y = mean)) +\n    geom_point(col = 'blue') +\n    geom_smooth() +\n    ylab('mean BMI') + xlab(\"Age\") +\n    ggtitle(\"Mean BMI vs persons age\")\n\n    mean.nutrition.p1 <- ggplot(mean.nutrition, aes(x = X_age80, y = mean)) +\n    ylab('Mean fruit and vegi consumption') + xlab(\"Age\") +\n    ggtitle(\"Mean fruit and vegi consumption \\nvs persons age\") +\n    geom_line(aes(y = mean.nutrition$mean, colour = \"red\"))\n\n    grid.arrange(mean.p1, mean.nutrition.p1, ncol = 2)\n    \n```\n\nThe following plot uses a function, which allows to overlay two individual plots to better identify a relation.  \nWe see that people around ~40 up to 60 consume less fruits and vegis, which corresponds with a high BMI. The fruit and \nvegi consumtion again rises from 60 up to 80. This as well can be seen in the dropping BMI curve. I can assume that there is \ncausaal relation between fruit and vegi consumption and BMI, but we also would need to consider other consumption pattern.\nThe fact that people often consume fruits and vegis is ofthen related to their general attitude in regards to helth. \nPeople being aware of health and nurtition often also lead a more active life in regards to physical excercise. That part \nwill be next to discover.\n<br>\n```{r, fig.width = 8, fig.height = 6}\n\n    # ====================================================================================================\n    # Create Plots\n    # ====================================================================================================\n\n    grid.newpage()\n\n    p1 <- ggplot(mean.bmi, aes(x = X_age80, y = mean)) +\n    geom_point(col = 'blue') +\n    ylab('mean BMI') + xlab(\"Age\") +\n    geom_smooth() + theme_bw()\n\n    p2 <- ggplot(mean.nutrition, aes(x = X_age80, y = mean)) +\n    geom_line(aes(y = mean.nutrition$mean), col = \"red\") +\n    ylab('Mean Fruit and Vegi consumtion') +\n    theme_bw() %+replace%\n    theme(panel.background = element_rect(fill = NA), plot.margin = unit(c(2,2,2,2), 'cm'))\n\n    # this function overlays two idividual plots to better identify a relation \n    overlay <- function(p1, p2) {\n\n    # extract gtable\n    g1 <- ggplot_gtable(ggplot_build(p1))\n    g2 <- ggplot_gtable(ggplot_build(p2))\n\n    # overlap the panel of 2nd plot on that of 1st plot\n    pp <- c(subset(g1$layout, name == \"panel\", se = t:r))\n    g <- gtable_add_grob(g1, g2$grobs[[which(g2$layout$name == \"panel\")]], pp$t,\n    pp$l, pp$b, pp$l)\n\n    # axis tweaks\n    ia <- which(g2$layout$name == \"axis-l\")\n    ga <- g2$grobs[[ia]]\n    ax <- ga$children[[2]]\n    ax$widths <- rev(ax$widths)\n    ax$grobs <- rev(ax$grobs)\n    ax$grobs[[1]]$x <- ax$grobs[[1]]$x - unit(1, \"npc\") + unit(0.15, \"cm\")\n    g <- gtable_add_cols(g, g2$widths[g2$layout[ia,]$l], length(g$widths) - 1)\n    g <- gtable_add_grob(g, ax, pp$t, length(g$widths) - 1, pp$b)\n\n    # draw it\n    grid.draw(g)\n}\n\noverlay(p1, p2)\n\n```\n\n\nWe consider again the same data displayed previously with the average BMI per age, but this time we will put those data in relation <br>\nto physical exercise. We see again two plots one we have seen before. The other displays the average excercise performed by the <br>\npopulation of a certain age. \n<br>\n\n```{r, fig.width=8, fig.height=6}\n    # remove NA values\n    data.rsq3_b <- data.rsq3_b[complete.cases(data.rsq3_b),]\n\n    mean.exercise <- ddply(data.rsq3_b, .(X_age80), summarise, meanEx = mean(pa1min_))\n    \n    # remove age 1 and 2 \n    mean.exercise <- mean.exercise[-1:-2,]\n\n    mean.p1 <- ggplot(mean.bmi, aes(x = X_age80, y = mean)) +\n    geom_point(col = 'blue') +\n    geom_smooth() +\n    ylab('mean BMI') + xlab(\"Age\") +\n    ggtitle(\"Average BMI vs persons age\")\n\n    mean.excercise.p1 <- ggplot(mean.exercise, aes(x = X_age80, y = mean)) +\n    ylab('mean execise per week') + xlab(\"Age\") +\n    ggtitle(\"Average excercise vs persons age\") +\n    geom_line(aes(y = mean.exercise$mean, col = 'red'))\n\n    grid.arrange(mean.p1, mean.excercise.p1, ncol = 2)\n```\n\n\nThis two plots again will be overlayed to better see a relation. \nThe final plot shows that up to the age of 40 not much physical activity has been performed. From there on it seems that a lot of people <br>\nseem to feel uncomfortable with their weight and start to excercise. This itself only partially supports the weight reduction. But if we <br>\nconsider the previous curve with the 'fruit and vegi consumption' and also consider the 'physical exercise' data and put them in relaion <br>\n(about age 60 to 80), we see a different picture. There seems to be a relation between nutrition, physical activity and BMI. \n<br>\n```{r, fig.width=8, fig.height=6}\n   \n    grid.newpage()\n\n    p1 <- ggplot(mean.bmi, aes(x = X_age80, y = mean)) +\n    geom_point(col = 'blue') +\n    ylab('Mean BMI') + xlab(\"Age\") +\n    geom_smooth() + theme_bw()\n\n    p2 <- ggplot(mean.exercise, aes(x = X_age80, y = mean)) +\n    geom_line(aes(y = mean.exercise$mean, colour = \"red\")) +\n    ylab('Mean fruit and vegi consumption') +\n    theme_bw() %+replace%\n    theme(panel.background = element_rect(fill = NA), plot.margin = unit(c(2,2,2,2), 'cm'))\n\n    overlay(p1, p2)\n\n```\n\n\n\n",
    "created" : 1464859759154.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2888211017",
    "id" : "F28A528D",
    "lastKnownWriteTime" : 1465192516,
    "last_content_update" : 1465192516,
    "path" : "C:/Users/bruno/OneDrive/Dokumente/Coursera_Courses/Statistics - Duke University/001_Introduction_to_Probability_and_Data/Week 5/Lab/Project5/intro_data_prob_project.Rmd",
    "project_path" : "intro_data_prob_project.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}